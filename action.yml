name: update readme
description: "update the notebook index in readme"
inputs:
  GITHUB_TOKEN:
    description: "secrets.GITHUB_TOKEN"
    required: true
  actor:
    description: "github.actor"
    required: true
  push_branch:
    description: "Target branch name to push the index"
    required: true
    default: "gh-page"
runs:
  using: "composite"
  steps:
  - name: Set up Python
    uses: actions/setup-python@v2
    with:
      python-version: '3.x'
  - name: update readme index
    shell: bash
    run: |
      wget https://raw.githubusercontent.com/junxnone/linux/main/docs/_sidebar.md -O linux.md
      wget https://raw.githubusercontent.com/junxnone/xwiki/main/docs/_sidebar.md -O xwiki.md

      cat linux.md |grep -v "Wiki History" |sed 's/\](\//\](linux\/docs\//g'|tee sitemap.md
      cat xwiki.md |grep -v "Wiki History" |sed 's/\](\//\](xwiki\/docs\//g'|tee -a sitemap.md

  - name: push to gh-page
    shell: bash
    run: |
      REMOTE=https://${{ inputs.GITHUB_TOKEN }}@github.com/${{ github.repository }}
      git config user.email "${{ inputs.actor }}@users.noreply.github.com"
      git config user.name "${{ inputs.actor }}"
      git pull ${REMOTE}
      git add sitemap.md
      git status
      git commit -am "Update Index"
      git push ${REMOTE}  ${{ inputs.branch }}
